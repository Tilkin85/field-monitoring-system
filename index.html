<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Monitoring System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.4.1/html-docx.js"></script>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“‹</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background-color: #f3f4f6;
            line-height: 1.6;
            color: #374151;
            padding: 20px;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 1.5rem;
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.875rem;
            font-weight: bold;
            color: #1f2937;
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
        }

        .btn-pdf {
            background-color: #dc2626;
            color: white;
        }

        .btn-pdf:hover {
            background-color: #b91c1c;
        }

        .btn-word {
            background-color: #2563eb;
            color: white;
        }

        .btn-word:hover {
            background-color: #1d4ed8;
        }

        .btn-json {
            background-color: #059669;
            color: white;
        }

        .btn-json:hover {
            background-color: #047857;
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
        }

        .btn-small {
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
        }

        .section {
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .section h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
        }

        .grid {
            display: grid;
            gap: 1rem;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        @media (max-width: 768px) {
            .grid-cols-2,
            .grid-cols-3,
            .grid-cols-4 {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: stretch;
            }

            .button-group {
                justify-content: center;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-item input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            border-radius: 0.25rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .alert-info {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            color: #1e40af;
        }

        .photo-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            background-color: #f9fafb;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload-area:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .photo-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 0.5rem;
            border: 2px solid #e5e7eb;
        }

        .linked-photo-preview {
            max-width: 100px;
            max-height: 75px;
            border-radius: 0.25rem;
            border: 1px solid #d1d5db;
        }

        .card {
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
            background-color: white;
            margin-bottom: 1rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #374151;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background-color: #dbeafe;
            color: #1e40af;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin: 0.125rem;
        }

        .flex {
            display: flex;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-3 {
            margin-bottom: 0.75rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mt-3 {
            margin-top: 0.75rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-xs {
            font-size: 0.75rem;
        }

        .text-center {
            text-align: center;
        }

        .text-red-600 {
            color: #dc2626;
        }

        .text-blue-600 {
            color: #2563eb;
        }

        .text-blue-800 {
            color: #1e40af;
        }

        .text-gray-400 {
            color: #9ca3af;
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .text-gray-600 {
            color: #4b5563;
        }

        .bg-blue-50 {
            background-color: #eff6ff;
        }

        .bg-blue-100 {
            background-color: #dbeafe;
        }

        .bg-red-100 {
            background-color: #fee2e2;
        }

        .border-blue-200 {
            border-color: #bfdbfe;
        }

        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .flex-1 {
            flex: 1;
        }

        .photo-link-section {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.5rem;
        }

        .export-info {
            background-color: #f0f9ff;
            border: 1px solid #0ea5e9;
            color: #0c4a6e;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        const FieldMonitoringApp = () => {
          const [formData, setFormData] = useState({
            monitor: '',
            projectName: '',
            date: '',
            projectNumber: '',
            totalHrs: '',
            totalMi: '',
            timeIn: '',
            timeOut: '',
            projectAreas: '',
            fossils: '',
            prehistoricArtifacts: '',
            historicArtifacts: '',
            architecturalFeatures: '',
            stratigraphy: '',
            grainSize: '',
            color: '',
            texture: '',
            sorting: '',
            seds: [],
            mineralization: [],
            siteConditions: '',
            excavationConditions: '',
            otherObservations: '',
            findingsReports: [{
              fieldNumber: '',
              fieldId: '',
              datum: 'NAD 83 CONUS',
              condition: '',
              contextDescription: '',
              approxAge: '',
              soils: '',
              location: '',
              fateOfLocality: '',
              linkedPhotoIds: []
            }],
            utmE: '',
            utmN: '',
            latitude: '',
            longitude: '',
            elevation: '',
            numberOfArtifacts: '',
            photoLog: [{ 
              id: 'photo_' + Date.now(), 
              photoNum: '', 
              date: '', 
              time: '', 
              gps: '', 
              direction: '', 
              description: '', 
              equipment: '', 
              photoFile: null, 
              photoPreview: null 
            }]
          });

          const handleInputChange = (field, value) => {
            setFormData(prev => ({ ...prev, [field]: value }));
          };

          const handleCheckboxChange = (field, value) => {
            setFormData(prev => ({
              ...prev,
              [field]: prev[field].includes(value) 
                ? prev[field].filter(item => item !== value)
                : [...prev[field], value]
            }));
          };

          const handleFindingsReportChange = (index, field, value) => {
            const newReports = [...formData.findingsReports];
            newReports[index][field] = value;
            setFormData(prev => ({ ...prev, findingsReports: newReports }));
          };

          const handlePhotoLinkChange = (reportIndex, photoId, isLinked) => {
            const newReports = [...formData.findingsReports];
            if (isLinked) {
              if (!newReports[reportIndex].linkedPhotoIds.includes(photoId)) {
                newReports[reportIndex].linkedPhotoIds.push(photoId);
              }
            } else {
              newReports[reportIndex].linkedPhotoIds = newReports[reportIndex].linkedPhotoIds.filter(id => id !== photoId);
            }
            setFormData(prev => ({ ...prev, findingsReports: newReports }));
          };

          const addFindingsReport = () => {
            setFormData(prev => ({
              ...prev,
              findingsReports: [...prev.findingsReports, {
                fieldNumber: '',
                fieldId: '',
                datum: 'NAD 83 CONUS',
                condition: '',
                contextDescription: '',
                approxAge: '',
                soils: '',
                location: '',
                fateOfLocality: '',
                linkedPhotoIds: []
              }]
            }));
          };

          const removeFindingsReport = (index) => {
            setFormData(prev => ({
              ...prev,
              findingsReports: prev.findingsReports.filter((_, i) => i !== index)
            }));
          };

          const handlePhotoLogChange = (index, field, value) => {
            const newPhotoLog = [...formData.photoLog];
            newPhotoLog[index][field] = value;
            setFormData(prev => ({ ...prev, photoLog: newPhotoLog }));
          };

          const handlePhotoUpload = (index, file) => {
            if (file && file.type.startsWith('image/')) {
              const reader = new FileReader();
              reader.onload = (e) => {
                const newPhotoLog = [...formData.photoLog];
                newPhotoLog[index].photoFile = file;
                newPhotoLog[index].photoPreview = e.target.result;
                setFormData(prev => ({ ...prev, photoLog: newPhotoLog }));
              };
              reader.readAsDataURL(file);
            } else {
              alert('Please select a valid image file (JPG, PNG, GIF, etc.)');
            }
          };

          const removePhoto = (index) => {
            const newPhotoLog = [...formData.photoLog];
            const photoId = newPhotoLog[index].id;
            newPhotoLog[index].photoFile = null;
            newPhotoLog[index].photoPreview = null;
            
            const newReports = formData.findingsReports.map(report => ({
              ...report,
              linkedPhotoIds: report.linkedPhotoIds.filter(id => id !== photoId)
            }));
            
            setFormData(prev => ({ 
              ...prev, 
              photoLog: newPhotoLog,
              findingsReports: newReports
            }));
          };

          const addPhotoEntry = () => {
            setFormData(prev => ({
              ...prev,
              photoLog: [...prev.photoLog, { 
                id: 'photo_' + Date.now(), 
                photoNum: '', 
                date: '', 
                time: '', 
                gps: '', 
                direction: '', 
                description: '', 
                equipment: '', 
                photoFile: null, 
                photoPreview: null 
              }]
            }));
          };

          const removePhotoEntry = (index) => {
            const photoId = formData.photoLog[index].id;
            
            const newReports = formData.findingsReports.map(report => ({
              ...report,
              linkedPhotoIds: report.linkedPhotoIds.filter(id => id !== photoId)
            }));
            
            setFormData(prev => ({
              ...prev,
              photoLog: prev.photoLog.filter((_, i) => i !== index),
              findingsReports: newReports
            }));
          };

          const getLinkedPhotos = (linkedPhotoIds) => {
            return formData.photoLog.filter(photo => linkedPhotoIds.includes(photo.id));
          };

          // Export functions
          const exportToJSON = () => {
            const timestamp = new Date().toLocaleString();
            const reportData = {
              id: 'REPORT_' + Date.now(),
              timestamp,
              data: formData
            };
            
            const dataStr = JSON.stringify(reportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `field_monitoring_report_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
          };

          const exportToPDF = () => {
            try {
              const { jsPDF } = window.jspdf;
              const doc = new jsPDF();
              let yPosition = 20;
              const lineHeight = 7;
              const margin = 20;
              const pageWidth = doc.internal.pageSize.width;
              const pageHeight = doc.internal.pageSize.height;

              // Helper function to add new page if needed
              const checkPageBreak = () => {
                if (yPosition > pageHeight - 30) {
                  doc.addPage();
                  yPosition = 20;
                }
              };

              // Helper function to add text with word wrapping
              const addWrappedText = (text, x, y, maxWidth) => {
                const lines = doc.splitTextToSize(text, maxWidth);
                doc.text(lines, x, y);
                return lines.length * lineHeight;
              };

              // Title
              doc.setFontSize(16);
              doc.setFont(undefined, 'bold');
              doc.text('FIELD MONITORING REPORT', pageWidth / 2, yPosition, { align: 'center' });
              yPosition += lineHeight * 2;

              // Basic Information
              doc.setFontSize(12);
              doc.setFont(undefined, 'bold');
              doc.text('BASIC INFORMATION', margin, yPosition);
              yPosition += lineHeight;
              doc.setFont(undefined, 'normal');
              doc.setFontSize(10);

              const basicInfo = [
                `Monitor: ${formData.monitor}`,
                `Project Name: ${formData.projectName}`,
                `Date: ${formData.date}`,
                `Project Number: ${formData.projectNumber}`,
                `Total Hours: ${formData.totalHrs}`,
                `Total Miles: ${formData.totalMi}`,
                `Time In: ${formData.timeIn}`,
                `Time Out: ${formData.timeOut}`
              ];

              basicInfo.forEach(info => {
                checkPageBreak();
                doc.text(info, margin, yPosition);
                yPosition += lineHeight;
              });

              yPosition += lineHeight;

              // Field Observations
              checkPageBreak();
              doc.setFontSize(12);
              doc.setFont(undefined, 'bold');
              doc.text('FIELD OBSERVATIONS', margin, yPosition);
              yPosition += lineHeight;
              doc.setFont(undefined, 'normal');
              doc.setFontSize(10);

              if (formData.projectAreas) {
                checkPageBreak();
                doc.text('Project Areas Monitored:', margin, yPosition);
                yPosition += lineHeight;
                yPosition += addWrappedText(formData.projectAreas, margin + 10, yPosition, pageWidth - margin * 2 - 10);
                yPosition += lineHeight;
              }

              const observations = [
                { title: 'Fossils', content: formData.fossils },
                { title: 'Prehistoric Artifacts/Ecofacts', content: formData.prehistoricArtifacts },
                { title: 'Historic Artifacts/Ecofacts', content: formData.historicArtifacts },
                { title: 'Architectural Features', content: formData.architecturalFeatures },
                { title: 'Stratigraphy', content: formData.stratigraphy }
              ];

              observations.forEach(obs => {
                if (obs.content) {
                  checkPageBreak();
                  doc.text(`${obs.title}:`, margin, yPosition);
                  yPosition += lineHeight;
                  yPosition += addWrappedText(obs.content, margin + 10, yPosition, pageWidth - margin * 2 - 10);
                  yPosition += lineHeight;
                }
              });

              // Lithology
              if (formData.grainSize || formData.color || formData.texture || formData.sorting || formData.seds.length > 0 || formData.mineralization.length > 0) {
                yPosition += lineHeight;
                checkPageBreak();
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('LITHOLOGY', margin, yPosition);
                yPosition += lineHeight;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);

                const lithologyInfo = [
                  `Grain Size: ${formData.grainSize}`,
                  `Color: ${formData.color}`,
                  `Texture: ${formData.texture}`,
                  `Sorting: ${formData.sorting}`,
                  `Sediments: ${formData.seds.join(', ')}`,
                  `Mineralization: ${formData.mineralization.join(', ')}`
                ].filter(info => !info.endsWith(': ') && !info.endsWith(': '));

                lithologyInfo.forEach(info => {
                  checkPageBreak();
                  doc.text(info, margin, yPosition);
                  yPosition += lineHeight;
                });
              }

              // Site Conditions
              yPosition += lineHeight;
              checkPageBreak();
              doc.setFontSize(12);
              doc.setFont(undefined, 'bold');
              doc.text('SITE & EXCAVATION CONDITIONS', margin, yPosition);
              yPosition += lineHeight;
              doc.setFont(undefined, 'normal');
              doc.setFontSize(10);

              const siteConditions = [
                { title: 'Site Conditions & Personnel', content: formData.siteConditions },
                { title: 'Excavation Conditions', content: formData.excavationConditions },
                { title: 'Other Observations & Comments', content: formData.otherObservations }
              ];

              siteConditions.forEach(condition => {
                if (condition.content) {
                  checkPageBreak();
                  doc.text(`${condition.title}:`, margin, yPosition);
                  yPosition += lineHeight;
                  yPosition += addWrappedText(condition.content, margin + 10, yPosition, pageWidth - margin * 2 - 10);
                  yPosition += lineHeight;
                }
              });

              // Findings Reports
              if (formData.findingsReports.length > 0) {
                yPosition += lineHeight;
                checkPageBreak();
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('FINDINGS REPORTS', margin, yPosition);
                yPosition += lineHeight;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);

                formData.findingsReports.forEach((finding, index) => {
                  checkPageBreak();
                  doc.setFont(undefined, 'bold');
                  doc.text(`Findings Report ${index + 1}:`, margin, yPosition);
                  yPosition += lineHeight;
                  doc.setFont(undefined, 'normal');

                  const findingInfo = [
                    `Field Number: ${finding.fieldNumber}`,
                    `Field ID: ${finding.fieldId}`,
                    `Datum: ${finding.datum}`,
                    `Condition: ${finding.condition}`,
                    `Approximate Age: ${finding.approxAge}`,
                    `Soils: ${finding.soils}`,
                    `Location: ${finding.location}`,
                    `Fate of Locality: ${finding.fateOfLocality}`
                  ].filter(info => !info.endsWith(': '));

                  findingInfo.forEach(info => {
                    checkPageBreak();
                    doc.text(info, margin + 10, yPosition);
                    yPosition += lineHeight;
                  });

                  if (finding.contextDescription) {
                    checkPageBreak();
                    doc.text('Context Description:', margin + 10, yPosition);
                    yPosition += lineHeight;
                    yPosition += addWrappedText(finding.contextDescription, margin + 20, yPosition, pageWidth - margin * 2 - 20);
                    yPosition += lineHeight;
                  }

                  if (finding.linkedPhotoIds.length > 0) {
                    checkPageBreak();
                    doc.text(`Linked Photos: ${finding.linkedPhotoIds.length} photo(s)`, margin + 10, yPosition);
                    yPosition += lineHeight;
                  }

                  yPosition += lineHeight;
                });
              }

              // Coordinates
              yPosition += lineHeight;
              checkPageBreak();
              doc.setFontSize(12);
              doc.setFont(undefined, 'bold');
              doc.text('COORDINATES', margin, yPosition);
              yPosition += lineHeight;
              doc.setFont(undefined, 'normal');
              doc.setFontSize(10);

              const coordinateInfo = [
                `UTM Easting: ${formData.utmE}`,
                `UTM Northing: ${formData.utmN}`,
                `Latitude N: ${formData.latitude}`,
                `Longitude W: ${formData.longitude}`,
                `Elevation: ${formData.elevation}`,
                `Number of Artifacts/Ecofacts: ${formData.numberOfArtifacts}`
              ].filter(info => !info.endsWith(': '));

              coordinateInfo.forEach(info => {
                checkPageBreak();
                doc.text(info, margin, yPosition);
                yPosition += lineHeight;
              });

              // Photo Log Summary
              if (formData.photoLog.some(photo => photo.photoNum || photo.description)) {
                yPosition += lineHeight;
                checkPageBreak();
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('PHOTO LOG SUMMARY', margin, yPosition);
                yPosition += lineHeight;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);

                formData.photoLog.forEach((photo, index) => {
                  if (photo.photoNum || photo.description) {
                    checkPageBreak();
                    doc.text(`Photo ${index + 1} (${photo.photoNum || 'No number'}):`, margin, yPosition);
                    yPosition += lineHeight;
                    
                    const photoInfo = [
                      `Date: ${photo.date}`,
                      `Time: ${photo.time}`,
                      `GPS: ${photo.gps}`,
                      `Direction: ${photo.direction}`,
                      `Equipment: ${photo.equipment}`
                    ].filter(info => !info.endsWith(': '));

                    photoInfo.forEach(info => {
                      checkPageBreak();
                      doc.text(info, margin + 10, yPosition);
                      yPosition += lineHeight;
                    });

                    if (photo.description) {
                      checkPageBreak();
                      doc.text('Description:', margin + 10, yPosition);
                      yPosition += lineHeight;
                      yPosition += addWrappedText(photo.description, margin + 20, yPosition, pageWidth - margin * 2 - 20);
                    }
                    yPosition += lineHeight;
                  }
                });
              }

              // Footer
              const timestamp = new Date().toLocaleString();
              doc.setFontSize(8);
              doc.text(`Generated on: ${timestamp}`, margin, pageHeight - 10);

              // Save the PDF
              const fileName = `field_monitoring_report_${new Date().toISOString().split('T')[0]}.pdf`;
              doc.save(fileName);
              
            } catch (error) {
              console.error('PDF generation error:', error);
              alert('Error generating PDF. Please try again.');
            }
          };

          const exportToWordDoc = () => {
            try {
              // Create HTML content for Word document
              const timestamp = new Date().toLocaleString();
              let htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                  <meta charset="UTF-8">
                  <title>Field Monitoring Report</title>
                  <style>
                    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.4; }
                    h1 { text-align: center; color: #333; border-bottom: 2px solid #333; padding-bottom: 10px; }
                    h2 { color: #555; border-bottom: 1px soli
